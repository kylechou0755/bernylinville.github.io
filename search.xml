<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Bitwarden搭建记录</title>
      <link href="2021/02/19/Bitwarden%E6%90%AD%E5%BB%BA%E8%AE%B0%E5%BD%95/"/>
      <url>2021/02/19/Bitwarden%E6%90%AD%E5%BB%BA%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<p>密码管理方案从最早的浏览器管理 -&gt; lastpass -&gt; 1password -&gt; keepass，本地保存和 syncthing 共享 keepass 数据。</p><p>kepassxc 在 mbp 上一直无法正常使用指纹解锁数据库，正好最近收到 Bitwarden 的安利，遂部署了该服务</p><h2 id="部署文件"><a href="#部署文件" class="headerlink" title="部署文件"></a>部署文件</h2><p>docker-compose.yml 文件如下：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">bitwarden:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">bitwardenrs/server</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">10001</span><span class="string">:10001</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;<span class="template-variable">&#123;&#123; bitwarden_data &#125;&#125;</span>:/data&#x27;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">ROCKET_PORT:</span> <span class="number">10001</span></span><br><span class="line">      <span class="attr">SIGNUPS_ALLOWED:</span> <span class="string">&#x27;true&#x27;</span>   <span class="comment"># 注册完账号之后，更改为 false 并重启容器</span></span><br><span class="line">      <span class="attr">DOMAIN:</span> <span class="string">&quot;https://bitwarden.example.com/base-dir&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>开启子路由转发，需要添加：DOMAIN: “<a href="https://bitwarden.example.com/base-dir&quot;">https://bitwarden.example.com/base-dir&quot;</a></p></blockquote><p>nginx conf 文件：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">location &#x2F;base-dir&#x2F; &#123;</span><br><span class="line">    proxy_set_header Host $http_host;</span><br><span class="line">    proxy_pass http:&#x2F;&#x2F;127.0.0.1:10001;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>注意不能漏掉后面的 /</p></blockquote><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>客户端和浏览器插件是独立的，体验很差</p><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ul><li><p><a href="https://github.com/dani-garcia/bitwarden_rs/wiki">bitwarden_rs/wiki</a></p></li><li><p><a href="https://github.com/dani-garcia/bitwarden_rs/wiki/Using-an-alternate-base-dir">Using an alternate base dir</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Key </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Key </tag>
            
            <tag> Bitwarden </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NAS整理记录</title>
      <link href="2021/02/17/NAS%E6%95%B4%E7%90%86%E8%AE%B0%E5%BD%95/"/>
      <url>2021/02/17/NAS%E6%95%B4%E7%90%86%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<p>由于2020 年贸易战的原因，担心 Google Drive 和 OneDrive 无法继续使用，又暂时没有能力肉翻，遂决定折腾在家部署 NAS。又本身就有淘汰的 CPU i7-4790 加上主板和内存，所以直接购入了机箱 <a href="https://item.jd.com/100007972013.html">银欣 CS380</a> 和 5 块 <a href="https://item.jd.com/694105.html#crumb-wrap">西部数据红盘</a></p><h2 id="折腾过程"><a href="#折腾过程" class="headerlink" title="折腾过程"></a>折腾过程</h2><p>期间折腾过 Unraid、OpenMediaVault、FreeNAS 和 Proxmox，决定使用 Unraid。经过半年时间的使用，Unraid 确实能胜任大部分工作，快捷的应用商店（和 linuxserver 合作的容器部署方案），虚拟机，smb 共享等。但问题也随之而来，部分容器 CPU 占用不正常，比如 qBittorrent 任务一多就会自动停止运行，后来发现 Unriad 容器 CPU 也是虚拟方案，不是直接使用宿主机上的，对于伪强迫症的我，就又开始寻找新的方案</p><p>过年期间在 v2ex 上看到了以前收藏的帖子 <a href="https://www.v2ex.com/t/723211">开源技术够用了么？我的 NAS 选型与搭建过程</a>，决定参照他的搭建过程来重新部署我的 NAS。</p><h3 id="系统和存储配置"><a href="#系统和存储配置" class="headerlink" title="系统和存储配置"></a>系统和存储配置</h3><p>操作系统使用的是 Debian testing，部署在 SSD 硬盘上，5 块 1T 硬盘做 zfs raidz1（也就是raid5）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">sudo zpool create -f -o ashift=12 -m /data mypool raidz \</span><br><span class="line">ata-WDC_WD10EFRX-68FYTN0_WD-WCC4J0SEF254 \</span><br><span class="line">ata-WDC_WD10EFRX-68FYTN0_WD-WCC4J0SEFN9A \</span><br><span class="line">ata-WDC_WD10EFRX-68FYTN0_WD-WCC4J0TDU34X \</span><br><span class="line">ta-WDC_WD10EFRX-68FYTN0_WD-WCC4J0TDUPT3 \</span><br><span class="line">ata-WDC_WD10EFRX-68FYTN0_WD-WCC4J7VF4NUS</span><br><span class="line"></span><br><span class="line">sudo zpool status</span><br><span class="line">  pool: mypool</span><br><span class="line"> state: ONLINE</span><br><span class="line">  scan: scrub repaired 0B in 00:26:26 with 0 errors on Sun Feb 14 00:50:28 2021</span><br><span class="line">config:</span><br><span class="line"></span><br><span class="line">NAME                                          STATE     READ WRITE CKSUM</span><br><span class="line">mypool                                        ONLINE       0     0     0</span><br><span class="line">  raidz1-0                                    ONLINE       0     0     0</span><br><span class="line">    ata-WDC_WD10EFRX-68FYTN0_WD-WCC4J0SEF254  ONLINE       0     0     0</span><br><span class="line">    ata-WDC_WD10EFRX-68FYTN0_WD-WCC4J0SEFN9A  ONLINE       0     0     0</span><br><span class="line">    ata-WDC_WD10EFRX-68FYTN0_WD-WCC4J0TDU34X  ONLINE       0     0     0</span><br><span class="line">    ata-WDC_WD10EFRX-68FYTN0_WD-WCC4J0TDUPT3  ONLINE       0     0     0</span><br><span class="line">    ata-WDC_WD10EFRX-68FYTN0_WD-WCC4J7VF4NUS  ONLINE       0     0     0</span><br><span class="line"></span><br><span class="line">errors: No known data errors</span><br><span class="line"></span><br><span class="line">sudo zpool list</span><br><span class="line">NAME     SIZE  ALLOC   FREE  CKPOINT  EXPANDSZ   FRAG    CAP  DEDUP    HEALTH  ALTROOT</span><br><span class="line">mypool  4.55T   155G  4.40T        -         -     1%     3%  1.00x    ONLINE  -</span><br></pre></td></tr></table></figure><h3 id="部署服务"><a href="#部署服务" class="headerlink" title="部署服务"></a>部署服务</h3><p>用 ansible 部署服务，比如 Nextcloud，qBittorrent（下载PT），qBittorrent-Enhanced-Edition（下载PT），aria2（下载百度网盘）等等，ansible 仓库在 <a href="https://github.com/bernylinville/playbooks">playbooks</a></p><blockquote><p>没有选择做 TimeMachine 备份是因为我定期会重装 mac 系统，备份还原参考 <a href="https://macosdoc.googo.cc/">macOS 日常 &amp; 备份 &amp; 还原</a></p></blockquote><h3 id="外部访问"><a href="#外部访问" class="headerlink" title="外部访问"></a>外部访问</h3><p>参考 <a href="https://github.com/oznu/docker-cloudflare-ddns">docker-cloudflare-ddns</a> 部署了 Cloudflare DDNS</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">cloudflare-ddns:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">oznu/cloudflare-ddns:latest</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">EMAIL=&lt;Cloudflare_Email&gt;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">API_KEY=&lt;Cloudflare_API_KEY&gt;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ZONE=&lt;example.com&gt;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SUBDOMAIN=subdomain</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">PROXIED=false</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>通过 acme.sh 用 Cloudflare api 的选项，生成并部署 SSL 证书，由于强国家庭网络不支持 80 和 443 端口对外转发，通过路由器配置 10000 以上的端口转发来访问服务</p><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ul><li><a href="https://www.v2ex.com/t/723211">开源技术够用了么？我的 NAS 选型与搭建过程</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> NAS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NAS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>新建博客记录</title>
      <link href="2021/02/17/%E6%96%B0%E5%BB%BA%E5%8D%9A%E5%AE%A2%E8%AE%B0%E5%BD%95/"/>
      <url>2021/02/17/%E6%96%B0%E5%BB%BA%E5%8D%9A%E5%AE%A2%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<blockquote><p><strong>这次真的不再折腾了</strong></p></blockquote><p>博客完全托管在 GitHub 上 <a href="https://github.com/bernylinville/bernylinville.github.io">bernylinville/bernylinville.github.io</a>，其中 blog 分支放的是 Hexo ，master 分支（即 GitHub Pages）是 Hexo 生成的静态博客页面</p><h3 id="利用-GitHub-Action-自动构建博客"><a href="#利用-GitHub-Action-自动构建博客" class="headerlink" title="利用 GitHub Action 自动构建博客"></a>利用 GitHub Action 自动构建博客</h3><p>yaml 文件如下：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Hexo</span> <span class="string">Deploy</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">blog</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">pages:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span> <span class="string">theme</span> <span class="string">repo</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">repository:</span> <span class="string">viosey/hexo-theme-material</span></span><br><span class="line">          <span class="attr">ref:</span> <span class="string">master</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">themes/material</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Use</span> <span class="string">Node.js</span> <span class="number">15.</span><span class="string">x</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/setup-node@v2</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">node-version:</span> <span class="string">&#x27;15.x&#x27;</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Cache</span> <span class="string">NPM</span> <span class="string">dependencies</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/cache@v2</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">node_modules</span></span><br><span class="line">          <span class="attr">key:</span> <span class="string">$&#123;&#123;</span> <span class="string">runner.OS</span> <span class="string">&#125;&#125;-npm-cache</span></span><br><span class="line">          <span class="attr">restore-keys:</span> <span class="string">|</span></span><br><span class="line">            <span class="string">$&#123;&#123;</span> <span class="string">runner.OS</span> <span class="string">&#125;&#125;-npm-cache</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">Dependencies</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">npm</span> <span class="string">install</span></span><br><span class="line">        </span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Build</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">build</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Deploy</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">peaceiris/actions-gh-pages@v3</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">deploy_key:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.ACTIONS_DEPLOY_KEY</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">publish_dir:</span> <span class="string">./public</span></span><br><span class="line">          <span class="attr">publish_branch:</span> <span class="string">master</span>  <span class="comment"># deploying branch</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>密钥配置参考 <a href="https://github.com/peaceiris/actions-gh-pages#%EF%B8%8F-create-ssh-deploy-key">Create SSH Deploy Key</a></p></blockquote><h3 id="主题配置"><a href="#主题配置" class="headerlink" title="主题配置"></a>主题配置</h3><p>主题使用的是 <a href="https://github.com/viosey/hexo-theme-material">hexo-theme-material</a></p><h3 id="萌-ICP-备案"><a href="#萌-ICP-备案" class="headerlink" title="萌 ICP 备案"></a>萌 ICP 备案</h3><p>自从开始做运维之后，时不时就和强国备案打交道，为此深恶痛疾。全段时间无意中看到 <a href="https://icp.gov.moe/AboutMoeICP.html">萌国ICP备案</a>，故将其加到博客上</p><h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><ul><li><p><a href="https://printempw.github.io/use-github-actions-to-deploy-hexo-blog/">使用 GitHub Actions 自动部署 Hexo 博客</a></p></li><li><p><a href="https://hexo.io/docs/github-pages">GitHub Pages</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Blog </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> Blog </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
